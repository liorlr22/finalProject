<html>
  <head>
      <!-- jQuery library -->
      <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>

      <!-- Popper JS -->
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  
      <!-- Latest compiled JavaScript -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- importing pages -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="icon" href="resources/arrow-circle-down.svg">

    <!-- importing external libraries -->
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    />

    <link rel="stylesheet" id="favicon" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- title -->
    <title>Youtube to Mp3 downloader</title>
  </head>
  <body>
    <!-- title -->
    <div class="container">
      <div class="row" style="margin: top 5vh;">
        <div class="h-100 d-flex align-items-center justify-content-center" style="width: 100%; height: 100%; margin-top: 20px;">
          <p class="Display-3" id="title" style="text-align: center;">Youtube to Mp3 downloader</p>
        </div>
      </div>
    </div>
    <!-- the form -->
    <form name="submitUrl" style="width: 100%;" onsubmit="toggleAnswer(document.getElementById('urlPlaceHolder').value)" id="linkReceive">
      <div class="form-group row" style="margin-top:8vh;">
        <label class="col-3"></label> 
        <div class="col-6">
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text">
                <i class="fa fa-link"></i>
              </div>
            </div> 
            <input id="urlPlaceHolder" name="text" placeholder="" type="url" required="required" class="form-control">
          </div>
        </div>
      </div> 
      <div class="form-group row">
        <label class="col-3"></label> 
        <div class="col-6">
          <button name="submit" type="submit" class="btn btn-primary" id="submit" style="width: 100%; height: 100%;">Submit</button>
        </div>
      </div>
    </form>
    <!-- <a href="#" download="myimage"><img src="https://picsum.photos/250" /></a> -->
    <!-- the result -->
    <div id="target" style="display: none;">
      <div class="d-flex justify-content-center" id="result" style="margin-top: 3vh;">
        <div class="card text-center mb-3" style="width: 49%; height: 100%;">
          <div class="card-body" style="width: 100%; height: 100%;">
            <h5 class="card-title" style="text-transform: capitalize;">the video selected: </h5>
            <div style="display:inline-block;">
              <div class="left">
                <img id="tnpic" src="https://picsum.photos/250" alt="result picture" style="border-radius: 5px;">
              <div>
                <p id="videoTitle" class="card-text" style="width: 100%; height: 100%;  margin-top:15px">Imagine dragons - Natural</p>
              </div>
              <form name="submitUrl" style="width: 100%; margin-top: 15px;" onsubmit="dnld(document.getElementById('dnldBtn').value)" id="downloadButton">
              <button id="dnldBtn" style="width:93%; height: 100%" class="btn btn-primary" type="submit">Download</button></form>
          </div>
          </div>
        </div>
      </div>
    </div>
    <!-- changing the class of the title based on the screen size -->
    <script>
      // let favicon = document.getElementById('favicon');
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector('link[rel=icon]').href = 'resources/icon-dark.png'
      }
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
        document.querySelector('link[rel=icon]').href = 'resources/icon-light.svg'
      }      
      const links = ["https://www.youtube.com/watch?v=dQw4w9WgXcQ&ab_channel=RickAstley",
                      "https://www.youtube.com/watch?v=ZHwVBirqD2s&ab_channel=EltonJohnVEVO",
                      "https://www.youtube.com/watch?v=SQCSxqScSVQ&ab_channel=CoolioVEVO",
                      "https://www.youtube.com/watch?v=7j7twuejxvU&ab_channel=ImagineDragonsVEVO",
                      "https://www.youtube.com/watch?v=w5tWYmIOWGk&ab_channel=ImagineDragonsVEVO",
                      "https://www.youtube.com/watch?v=dvgZkm1xWPE&ab_channel=Coldplay",
                      "https://www.youtube.com/watch?v=PIh2xe4jnpk&ab_channel=ournameismagicVEVO",
                      "https://www.youtube.com/watch?v=KRaWnd3LJfs&ab_channel=Maroon5VEVO",
                      "https://www.youtube.com/watch?v=qpgTC9MDx1o&ab_channel=Maroon5VEVO",
                      "https://www.youtube.com/watch?v=hT_nvWreIhg&ab_channel=OneRepublicVEVO"];


      let urlPlaceHolder = document.getElementById("urlPlaceHolder");
      let randomNumber = Math.floor(Math.random() * 10);
      urlPlaceHolder.placeholder = links[randomNumber];
      $(document).ready(function(){
        w_w = $(window).width();
        // alert(w_w)
        if(w_w >= 1920){
            $("#title").addClass('Display-2');
            $("#title").removeClass('Display-1');
            $("#title").removeClass('Display-3');
            $("#title").removeClass('Display-4');
        }
        //onResize
        $(window).resize(function(){
        w_w = $(window).width();
        // if(w_w < 1920 && w_w > 980){
        //   $("#title").addClass('Display-4');
        //   $("#submit").css('width', '50vh');
        //   alert(w_w);
        // } else if(w_w <= 980) {
        //   $("#title").addClass('Display-4');
        //   // $("#title").css("display", "inline");
        //   $("#submit").css('width', '44vh');
        //   alert(w_w);
        // } else {
        //   $("#title").removeClass('Display-4');
        //   $("#title").addClass('Display-2');
        //   $("#submit").css('width', '101vh');
        //   alert(w_w);
        // }
        if(w_w >= 3840){
          $("#title").addClass('Display-1');
          $("#title").removeClass('Display-2');
          $("#title").removeClass('Display-3');
          $("#title").removeClass('Display-4');
        } else if(w_w < 3840 && w_w >= 1920){
          $("#title").addClass('Display-2');
          $("#title").removeClass('Display-1');
          $("#title").removeClass('Display-3');
          $("#title").removeClass('Display-4');
        } else if(w_w < 1920 && w_w >= 768){
          $("#title").addClass('Display-3');
          $("#title").removeClass('Display-1');
          $("#title").removeClass('Display-2');
          $("#title").removeClass('Display-4');
        } else {
          $("#title").addClass('Display-4');
          $("#title").removeClass('Display-1');
          $("#title").removeClass('Display-2');
          $("#title").removeClass('Display-3');
        }
        });
        
      });

      $("#linkReceive").submit(function(e) {
        e.preventDefault();
      });
      var target = document.getElementById("target");
      var frm = document.getElementsByName("submitUrl")[0];
      var dnldVar = document.getElementById("dnldBtn");
      function toggleAnswer(link) {
        if (link != ""){
          if (target.style.display === "none") {
            console.log("in");
            var pic = document.getElementById("tnpic");
            if (link.indexOf('=') > -1){
              link = link.split("=");
              if (link.length == 2){
                link = link[1];
              } else {
                link = link[1];
                link = link.split('&');
                link = link[0];
              }
            } else {
              link = link.split('/');
              link = link[link.length - 1];
            }
            let src = "https://img.youtube.com/vi/" + link + "/0.jpg";
            localStorage.setItem('thumbnail', `${src}`);
            pic.src= src;
            var obj = "https://www.googleapis.com/youtube/v3/videos?id=" + link + "&key=AIzaSyAcwblTx35lcf6pF9ZtB5ptLSGvTGwIXp4&fields=items(snippet(title))&part=snippet";
            console.log(obj);
            const getJSON = async obj => {
              const response = await fetch(obj);
              return response.json(); // get JSON from the response 
            }
            getJSON(obj).then(data => data.items[0].snippet.title).then(title => {document.getElementById("videoTitle").innerHTML = title,
                                                                                  localStorage.setItem('title', `${title}`)});

            pic.style.height="75%";
            pic.style.width="75%";
            target.style.display = "block";
            frm.reset();
          } 
        } else {
            console.log("out");
            target.style.display = "none";
          }
      }
      function dnld(btn){
        let link = localStorage.getItem('thumbnail');
        // link = link.slice(8);
        window.open(link, '_blank');
        // link = "/" + link;
        let title = localStorage.getItem('title') + ".png";
        var a = document.createElement('a');
        a.href = link;
        a.download = title;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }
  </script>
  </body>
</html>